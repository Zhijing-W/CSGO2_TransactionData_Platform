{% extends "base.html" %}

{% block title %}Dashboard - {{ current_user.display_name }}{% endblock %}

{% block content %}
    <h1>Portfolio Dashboard for {{ current_user.display_name }}</h1>
    
    <table>
        <thead>
            <tr>
                <th>Total Investment</th>
                <th>Current Market Value</th>
                <th>Realized PnL</th>
                <th>Unrealized PnL</th>
                <th>Total PnL</th>
                <th>ROI</th>
            </tr>
        </thead>
        <tbody>
            {% for row in portfolios %}
            <tr>
                <td>{{ "%.2f"|format(row.total_investment or 0) }}</td>
                <td>{{ "%.2f"|format(row.total_market_value or 0) }}</td>
                
                {% set realized_pnl = row.total_realized_pnl or 0 %}
                {% if realized_pnl > 0 %}
                    <td style="color: green;">+{{ "%.2f"|format(realized_pnl) }}</td>
                {% else %}
                    <td style="color: red;">{{ "%.2f"|format(realized_pnl) }}</td>
                {% endif %}

                {% set unrealized_pnl = row.total_unrealized_pnl or 0 %}
                {% if unrealized_pnl > 0 %}
                    <td style="color: green;">+{{ "%.2f"|format(unrealized_pnl) }}</td>
                {% else %}
                    <td style="color: red;">{{ "%.2f"|format(unrealized_pnl) }}</td>
                {% endif %}

                {% set total_pnl = row.total_pnl or 0 %}
                {% if total_pnl > 0 %}
                    <td style="color: green; font-weight: bold;">+{{ "%.2f"|format(total_pnl) }}</td>
                {% else %}
                    <td style="color: red; font-weight: bold;">{{ "%.2f"|format(total_pnl) }}</td>
                {% endif %}
                
                {% set roi = row.roi_percent or 0 %}
                {% if roi > 0 %}
                    <td style="color: green; font-weight: bold;">{{ "%.2f"|format(roi) }}%</td>
                {% else %}
                    <td style="color: red; font-weight: bold;">{{ "%.2f"|format(roi) }}%</td>
                {% endif %}
            </tr>
            {% else %}
            <tr><td colspan="6">You have no portfolio data yet. Add a purchase to get started.</td></tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}